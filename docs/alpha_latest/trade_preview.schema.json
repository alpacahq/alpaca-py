{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "TradePreview",
  "type": "object",
  "properties": {
    "mode": { "type": "string", "enum": ["DRY_RUN","LIVE"] },
    "action": { "type": "string", "enum": ["buy","sell"] },
    "symbol": { "type": "string" },
    "qty": { "type": "number" },
    "order": {
      "type": "object",
      "properties": {
        "type": { "type": "string", "enum": ["limit","market","stop","stop_limit"] },
        "price": { "type": ["number","null"] },
        "tif": { "type": "string", "enum": ["day","gtc"] },
        "session": { "type": "string", "enum": ["RTH","EXT"] }
      },
      "required": ["type","tif","session"],
      "additionalProperties": false
    },
    "exits": {
      "type": "object",
      "properties": {
        "stop": { "type": ["number","null"] },
        "target": { "type": ["number","null"] },
        "trailing": {
          "type": "object",
          "properties": {
            "type": { "type": "string", "enum": ["percent","price"] },
            "value": { "type": ["number","null"] }
          },
          "required": ["type","value"],
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "risk": {
      "type": "object",
      "properties": {
        "perTradePct": { "type": "number", "default": 0.02 },
        "rr": { "type": "number" }
      },
      "additionalProperties": false
    },
    "data_freshness": {
      "type": "object",
      "properties": {
        "quote_asof": { "type": "string", "format": "date-time" },
        "quote_ttl_s": { "type": "integer", "default": 10 },
        "quote_ttl_ok": { "type": "boolean" },
        "balances_asof": { "type": "string", "format": "date-time" },
        "balances_ttl_s": { "type": "integer", "default": 10 },
        "balances_ttl_ok": { "type": "boolean" },
        "positions_asof": { "type": "string", "format": "date-time" },
        "positions_ttl_s": { "type": "integer", "default": 10 },
        "positions_ttl_ok": { "type": "boolean" }
      },
      "required": ["quote_asof","quote_ttl_ok","balances_asof","balances_ttl_ok","positions_asof","positions_ttl_ok"],
      "additionalProperties": false
    },
    "assumptions": { "type": "array", "items": { "type": "string" } }
  },
  "required": ["mode","action","symbol","qty","order","data_freshness"],
  "additionalProperties": false
}

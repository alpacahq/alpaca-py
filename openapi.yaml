openapi: 3.1.0
jsonSchemaDialect: https://json-schema.org/draft/2020-12/schema

# Align top-level keys at the root to ensure the document remains valid.
info:
  title: Alpaca Wrapper
  version: 1.0.1

# The server definition must point at the deployed domain that serves the
# manifest and schema files consumed by custom GPTs.
servers:
  - url: https://alpaca-py-production.up.railway.app
    description: Production deployment

# Require the ApiKeyAuth security scheme by default.  Operations that should
# remain publicly accessible explicitly override this with `security: []`.
security:
  - ApiKeyAuth: []
paths:
  /v2/orders:
    post:
      summary: Create order (Alpaca REST)
      operationId: order_create
      x-canonical-operation: order.create
      security:
        - ApiKeyAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateOrder'
      responses:
        '200':
          description: Order accepted
        '4XX':
          description: Client error
        '5XX':
          description: Server error
  /v1/order/bracket:
    post:
      tags:
      - Orders
      summary: Place Bracket
      operationId: placeBracketOrder
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BracketOrderBody'
        required: true
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema: {}
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /v1/order/stop:
    post:
      tags:
      - Orders
      summary: Place Stop
      operationId: placeStopOrder
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/StopOrderBody'
        required: true
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema: {}
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /v1/order/trailing:
    post:
      tags:
      - Orders
      summary: Place Trailing
      operationId: placeTrailingStopOrder
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TrailingOrderBody'
        required: true
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema: {}
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /healthz:
    get:
      summary: Healthz
      operationId: healthz
      security: []
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema: {}
  /v1/order:
    post:
      summary: Submit Order
      operationId: submitOrder
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/OrderIn'
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema: {}
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /v1/orders:
    get:
      summary: List Orders
      operationId: listOrders_v1
      parameters:
      - name: status
        in: query
        required: false
        schema:
          type: string
          enum:
          - open
          - closed
          - all
          default: open
          title: Status
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema: {}
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /v1/orders/{order_id}:
    get:
      summary: Get order by ID
      operationId: getOrderById_v1
      parameters:
      - name: order_id
        in: path
        required: true
        schema:
          type: string
          title: Order Id
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema: {}
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /v2/orders/{order_id}:
    delete:
      summary: Cancel order by ID
      operationId: cancelOrderById_v2
      parameters:
      - name: order_id
        in: path
        required: true
        schema:
          type: string
          title: Order Id
      responses:
        '204':
          description: Order cancelled
  /v1/account:
    get:
      summary: Get Account
      operationId: getAccount
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema: {}
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /v1/positions:
    get:
      summary: List Positions
      operationId: listPositions
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema: {}
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
    delete:
      summary: Close All Positions
      operationId: closeAllPositions
      parameters:
      - name: cancel_orders
        in: query
        required: false
        schema:
          type: boolean
          default: false
          title: Cancel Orders
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema: {}
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /v1/positions/{symbol}:
    get:
      summary: Get Position
      operationId: getPosition
      parameters:
      - name: symbol
        in: path
        required: true
        schema:
          type: string
          title: Symbol
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema: {}
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
    delete:
      summary: Close Position
      operationId: closePosition
      parameters:
      - name: symbol
        in: path
        required: true
        schema:
          type: string
          title: Symbol
      - name: cancel_orders
        in: query
        required: false
        schema:
          type: boolean
          default: false
          title: Cancel Orders
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema: {}
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /v1/watchlists:
    get:
      summary: List Watchlists
      operationId: list_watchlists_v1_watchlists_get
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema: {}
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
    post:
      summary: Create Watchlist
      operationId: create_watchlist_v1_watchlists_post
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/WatchlistIn'
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema: {}
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /v1/watchlists/{watchlist_id}:
    get:
      summary: Get Watchlist
      operationId: get_watchlist_v1_watchlists__watchlist_id__get
      parameters:
      - name: watchlist_id
        in: path
        required: true
        schema:
          type: string
          title: Watchlist Id
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema: {}
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
    put:
      summary: Update Watchlist
      operationId: update_watchlist_v1_watchlists__watchlist_id__put
      parameters:
      - name: watchlist_id
        in: path
        required: true
        schema:
          type: string
          title: Watchlist Id
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/WatchlistIn'
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema: {}
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
    delete:
      summary: Delete Watchlist
      operationId: delete_watchlist_v1_watchlists__watchlist_id__delete
      parameters:
      - name: watchlist_id
        in: path
        required: true
        schema:
          type: string
          title: Watchlist Id
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema: {}
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /v1/quotes:
    get:
      summary: Get Quotes
      operationId: get_quotes_v1_quotes_get
      parameters:
      - name: symbol
        in: query
        required: true
        schema:
          type: string
          title: Symbol
      - name: start
        in: query
        required: true
        schema:
          type: string
          title: Start
      - name: end
        in: query
        required: true
        schema:
          type: string
          title: End
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema: {}
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /v1/trades:
    get:
      summary: Get Trades
      operationId: get_trades_v1_trades_get
      parameters:
      - name: symbol
        in: query
        required: true
        schema:
          type: string
          title: Symbol
      - name: start
        in: query
        required: true
        schema:
          type: string
          title: Start
      - name: end
        in: query
        required: true
        schema:
          type: string
          title: End
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema: {}
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /v1/bars:
    get:
      summary: Get Bars
      operationId: get_bars_v1_bars_get
      parameters:
      - name: symbol
        in: query
        required: true
        schema:
          type: string
          title: Symbol
      - name: timeframe
        in: query
        required: false
        schema:
          type: string
          default: 1Day
          title: Timeframe
      - name: start
        in: query
        required: true
        schema:
          type: string
          title: Start
      - name: end
        in: query
        required: false
        schema:
          anyOf:
          - type: string
          - type: 'null'
          title: End
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema: {}
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /openapi.yaml:
    get:
      summary: Spec
      operationId: spec_openapi_yaml_get
      security: []
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema: {}
components:
  securitySchemes:
    ApiKeyAuth:
      type: apiKey
      in: header
      name: x-api-key
  schemas:
    CreateOrder:
      type: object
      additionalProperties: false
      required:
        - symbol
        - side
        - type
        - time_in_force
      properties:
        symbol:
          type: string
        side:
          type: string
          enum: [buy, sell]
        qty:
          type: number
          minimum: 1
        notional:
          type: number
          minimum: 1
        type:
          type: string
          enum: [market, limit, stop, stop_limit, trailing_stop]
        time_in_force:
          type: string
          enum: [day, gtc]
        limit_price:
          type: number
          nullable: true
        stop_price:
          type: number
          nullable: true
        trail_price:
          type: number
          nullable: true
        trail_percent:
          type: number
          nullable: true
        order_class:
          type: string
          enum: [simple, bracket, oco, oto]
          default: simple
        take_profit:
          type: object
          additionalProperties: false
          properties:
            limit_price:
              type: number
        stop_loss:
          type: object
          additionalProperties: false
          properties:
            stop_price:
              type: number
            limit_price:
              type: number
        extended_hours:
          type: boolean
          default: false
      oneOf:
        - required: [qty]
          not:
            required: [notional]
        - required: [notional]
          not:
            required: [qty]
      allOf:
        - if:
            properties:
              type:
                const: trailing_stop
          then:
            oneOf:
              - required: [trail_price]
              - required: [trail_percent]
            properties:
              limit_price:
                nullable: true
              stop_price:
                nullable: true
        - if:
            properties:
              order_class:
                const: bracket
          then:
            required: [take_profit, stop_loss]
    BracketOrderBody:
      properties:
        symbol:
          type: string
          title: Symbol
        side:
          type: string
          title: Side
        type:
          type: string
          enum:
          - market
          - limit
          title: Type
          default: market
        qty:
          anyOf:
          - type: number
          - type: 'null'
          title: Qty
        notional:
          anyOf:
          - type: number
          - type: 'null'
          title: Notional
        limit_price:
          anyOf:
          - type: number
          - type: 'null'
          title: Limit Price
        time_in_force:
          type: string
          title: Time In Force
          default: day
        order_class:
          type: string
          const: bracket
          title: Order Class
          default: bracket
        take_profit:
          $ref: '#/components/schemas/TakeProfit'
        stop_loss:
          $ref: '#/components/schemas/StopLoss'
        extended_hours:
          anyOf:
          - type: boolean
          - type: 'null'
          title: Extended Hours
          default: false
        client_order_id:
          anyOf:
          - type: string
          - type: 'null'
          title: Client Order Id
      type: object
      required:
      - symbol
      - side
      - take_profit
      - stop_loss
      title: BracketOrderBody
    HTTPValidationError:
      properties:
        detail:
          items:
            $ref: '#/components/schemas/ValidationError'
          type: array
          title: Detail
      type: object
      title: HTTPValidationError
    OrderIn:
      properties:
        symbol:
          type: string
          title: Symbol
        side:
          type: string
          title: Side
        qty:
          anyOf:
          - type: number
          - type: 'null'
          title: Qty
        notional:
          anyOf:
          - type: number
          - type: 'null'
          title: Notional
        type:
          type: string
          title: Type
        time_in_force:
          type: string
          title: Time In Force
        limit_price:
          anyOf:
          - type: number
          - type: 'null'
          title: Limit Price
      type: object
      required:
      - symbol
      - side
      - type
      - time_in_force
      title: OrderIn
    StopLoss:
      properties:
        stop_price:
          type: number
          title: Stop Price
        limit_price:
          anyOf:
          - type: number
          - type: 'null'
          title: Limit Price
      type: object
      required:
      - stop_price
      title: StopLoss
    StopOrderBody:
      properties:
        symbol:
          type: string
          title: Symbol
        side:
          type: string
          title: Side
        qty:
          anyOf:
          - type: number
          - type: 'null'
          title: Qty
        notional:
          anyOf:
          - type: number
          - type: 'null'
          title: Notional
        time_in_force:
          type: string
          title: Time In Force
          default: day
        stop_price:
          type: number
          title: Stop Price
        extended_hours:
          anyOf:
          - type: boolean
          - type: 'null'
          title: Extended Hours
          default: false
        client_order_id:
          anyOf:
          - type: string
          - type: 'null'
          title: Client Order Id
      type: object
      required:
      - symbol
      - side
      - stop_price
      title: StopOrderBody
    TakeProfit:
      properties:
        limit_price:
          type: number
          title: Limit Price
      type: object
      required:
      - limit_price
      title: TakeProfit
    TrailingOrderBody:
      properties:
        symbol:
          type: string
          title: Symbol
        side:
          type: string
          title: Side
        qty:
          anyOf:
          - type: number
          - type: 'null'
          title: Qty
        notional:
          anyOf:
          - type: number
          - type: 'null'
          title: Notional
        time_in_force:
          type: string
          title: Time In Force
          default: day
        trail_price:
          anyOf:
          - type: number
          - type: 'null'
          title: Trail Price
        trail_percent:
          anyOf:
          - type: number
          - type: 'null'
          title: Trail Percent
        extended_hours:
          anyOf:
          - type: boolean
          - type: 'null'
          title: Extended Hours
          default: false
        client_order_id:
          anyOf:
          - type: string
          - type: 'null'
          title: Client Order Id
      type: object
      required:
      - symbol
      - side
      title: TrailingOrderBody
    ValidationError:
      properties:
        loc:
          items:
            anyOf:
            - type: string
            - type: integer
          type: array
          title: Location
        msg:
          type: string
          title: Message
        type:
          type: string
          title: Error Type
      type: object
      required:
      - loc
      - msg
      - type
      title: ValidationError
    WatchlistIn:
      properties:
        name:
          type: string
          title: Name
        symbols:
          items:
            type: string
          type: array
          title: Symbols
      type: object
      required:
      - name
      - symbols
      title: WatchlistIn
  securitySchemes:
    ApiKeyAuth:
      type: apiKey
      in: header
      name: x-api-key

